<!DOCTYPE html>
<html>
  <head>
    <title>认识美好的 R</title>
    <meta charset="utf-8">
    <meta name="author" content="Chris Qi" />
    <meta name="date" content="2018-01-01" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="zh-CN.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# 认识美好的 R
## 基础作图
### Chris Qi
### 2018

---




background-image: url(https://www.dropbox.com/s/zk8948u32y01sj8/logo.png?dl=1)
background-size: 700px
background-position: 50% 50%

---
background-image: url(https://www.dropbox.com/s/zk8948u32y01sj8/logo.png?dl=1)
background-size: 200px
background-position: 95% 3%


---
# R 基础作图快速入门

导语：用数据说话的今天，随着数据量的不断增加，数据可视化成为将数字变成可用的信息的一个重要方式。

--
* Base graphics: 最容易上手, 同时也非常有用的绘图技巧, 是这一节课的主要内容。


--
* Grid graphics: 开发其它作图工具的强大工具


--
* Lattice graphics: 基于 grid graphics的一般作图系统


--
* ggplot2: 有语法，用写作的方式作图，非常炫酷，可视化必备

---
Base graphics:

```r
 library(MASS)
plot(UScereal$sugars, UScereal$calories)
title("plot(UScereal$sugars, UScereal$calories)")
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-1-1.png)&lt;!-- --&gt;

---
Grid graphics，非人类的语言，不适用于一般的数据可视化:

```r
# Get the data and load the grid package
library(MASS)
x &lt;- UScereal$sugars
y &lt;- UScereal$calories
library(grid)
# This is the grid code required to generate the plot
pushViewport(plotViewport())
pushViewport(dataViewport(x, y))
grid.rect()
grid.xaxis()
grid.yaxis()
grid.points(x, y)
grid.text("UScereal$calories", x = unit(-3, "lines"), rot = 90)
grid.text("UScereal$sugars", y = unit(-3, "lines"), rot = 0)
popViewport(2)
```

---
Grid graphics，非人类的语言，不适用于一般的数据可视化:
![](slides_basicGraphs_files/figure-html/unnamed-chunk-3-1.png)&lt;!-- --&gt;

---
Lattice graphics:

```r
library(MASS)
library(lattice)
xyplot(MPG.city ~ Horsepower | Cylinders, data = Cars93)
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-4-1.png)&lt;!-- --&gt;

---
ggplot2:

```r
library(MASS)
library(ggplot2)
title &lt;-
 "ggplot2 plot of \n UScereal$calories vs. \n UScereal$sugars"
basePlot &lt;- ggplot(UScereal, aes(x = sugars, y = calories))
basePlot +
 geom_point(shape = as.character(UScereal$shelf), size = 3) +
 annotate("text", label = title, x = 3, y = 400,
 colour = "red")
```

---
ggplot2:

```r
library(MASS)
library(ggplot2)
title &lt;-
 "ggplot2 plot of \n UScereal$calories vs. \n UScereal$sugars"
basePlot &lt;- ggplot(UScereal, aes(x = sugars, y = calories))
basePlot +
 geom_point(shape = as.character(UScereal$shelf), size = 3) +
 annotate("text", label = title, x = 3, y = 400,
 colour = "red")
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-6-1.png)&lt;!-- --&gt;

---
## 探索性数据可视化:
帮助你看一看数据里都有什么，注意尽量多地保留细节，便于进一步分析

---
探索小鸡的成长之路：ChickWeight数据集

```r
plot(ChickWeight)
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-7-1.png)&lt;!-- --&gt;

---
* 解释性数据可视化：让别人明白数据，便于交流信息，呈现你的数据发现

---
请在下面的练习开始前，安装下面这些包 并载入：

```r
install.packages("insuranceData")
install.packages("MASS")
install.packages("robustbase")
install.packages("car")
install.packages("aplpack")
install.packages("corrplot")
install.packages("rpart")
```


```r
# Load MASS package
library(dplyr)
library(MASS)
library(robustbase)
library(insuranceData)
library(car)
```


```
## Warning: package 'dplyr' was built under R version 3.5.1
```

```
## 
## Attaching package: 'dplyr'
```

```
## The following object is masked from 'package:MASS':
## 
##     select
```

```
## The following objects are masked from 'package:stats':
## 
##     filter, lag
```

```
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
```

```
## Loading required package: carData
```

```
## 
## Attaching package: 'car'
```

```
## The following object is masked from 'package:dplyr':
## 
##     recode
```

---
我们用一个简单的冬季取暖数据来建构一个简单的分析图：

--
* Temp: 一周的室外气温

--
* Gas: 该周的天然气用量

--
* Insul: 有两个值的分类变量，分别代表房子升级改造前后

---
简单绘图看一下：

```r
# Plot whiteside data
plot(whiteside)
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-11-1.png)&lt;!-- --&gt;

---
简单的探索性散点图：
不要完全依赖默认设置，适当修改，让图更有意义容易理解
做一个气温与天然气用量的散点图，加上轴标签：

--

```r
plot(whiteside$Temp,whiteside$Gas,
     xlab="Outside temperature",
     ylab= "Heating gas consumption")
```

---
简单的探索性散点图：
不要完全依赖默认设置，适当修改，让图更有意义容易理解
做一个气温与天然气用量的散点图，加上轴标签：

![](slides_basicGraphs_files/figure-html/unnamed-chunk-13-1.png)&lt;!-- --&gt;

---
`plot()`是一个一般性的函数，会根据数据类型的不同而作出不同的图，例如下面，我们把它用在`whiteside$Insul`上，得到一个完全不一样的图

```r
plot(whiteside$Insul)
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;

---
使用形状，颜色和参考线来增加细节，我们用Cars93这个数据集来做一个高级一点的图来展示三个变量间的关系：

--
* Price: 某款车的平均售价

--
* Max.Price: 该款车的最高售价

--
* Min.Price: 该款车的最低售价

---
使用 `glimpse()` 来看看这个Cars93 都有什么变量

```r
glimpse(Cars93)
```

```
## Observations: 93
## Variables: 27
## $ Manufacturer       &lt;fct&gt; Acura, Acura, Audi, Audi, BMW, Buick, Buick...
## $ Model              &lt;fct&gt; Integra, Legend, 90, 100, 535i, Century, Le...
## $ Type               &lt;fct&gt; Small, Midsize, Compact, Midsize, Midsize, ...
## $ Min.Price          &lt;dbl&gt; 12.9, 29.2, 25.9, 30.8, 23.7, 14.2, 19.9, 2...
## $ Price              &lt;dbl&gt; 15.9, 33.9, 29.1, 37.7, 30.0, 15.7, 20.8, 2...
## $ Max.Price          &lt;dbl&gt; 18.8, 38.7, 32.3, 44.6, 36.2, 17.3, 21.7, 2...
## $ MPG.city           &lt;int&gt; 25, 18, 20, 19, 22, 22, 19, 16, 19, 16, 16,...
## $ MPG.highway        &lt;int&gt; 31, 25, 26, 26, 30, 31, 28, 25, 27, 25, 25,...
## $ AirBags            &lt;fct&gt; None, Driver &amp; Passenger, Driver only, Driv...
## $ DriveTrain         &lt;fct&gt; Front, Front, Front, Front, Rear, Front, Fr...
## $ Cylinders          &lt;fct&gt; 4, 6, 6, 6, 4, 4, 6, 6, 6, 8, 8, 4, 4, 6, 4...
## $ EngineSize         &lt;dbl&gt; 1.8, 3.2, 2.8, 2.8, 3.5, 2.2, 3.8, 5.7, 3.8...
## $ Horsepower         &lt;int&gt; 140, 200, 172, 172, 208, 110, 170, 180, 170...
## $ RPM                &lt;int&gt; 6300, 5500, 5500, 5500, 5700, 5200, 4800, 4...
## $ Rev.per.mile       &lt;int&gt; 2890, 2335, 2280, 2535, 2545, 2565, 1570, 1...
## $ Man.trans.avail    &lt;fct&gt; Yes, Yes, Yes, Yes, Yes, No, No, No, No, No...
## $ Fuel.tank.capacity &lt;dbl&gt; 13.2, 18.0, 16.9, 21.1, 21.1, 16.4, 18.0, 2...
## $ Passengers         &lt;int&gt; 5, 5, 5, 6, 4, 6, 6, 6, 5, 6, 5, 5, 5, 4, 6...
## $ Length             &lt;int&gt; 177, 195, 180, 193, 186, 189, 200, 216, 198...
## $ Wheelbase          &lt;int&gt; 102, 115, 102, 106, 109, 105, 111, 116, 108...
## $ Width              &lt;int&gt; 68, 71, 67, 70, 69, 69, 74, 78, 73, 73, 74,...
## $ Turn.circle        &lt;int&gt; 37, 38, 37, 37, 39, 41, 42, 45, 41, 43, 44,...
## $ Rear.seat.room     &lt;dbl&gt; 26.5, 30.0, 28.0, 31.0, 27.0, 28.0, 30.5, 3...
## $ Luggage.room       &lt;int&gt; 11, 15, 14, 17, 13, 16, 17, 21, 14, 18, 14,...
## $ Weight             &lt;int&gt; 2705, 3560, 3375, 3405, 3640, 2880, 3470, 4...
## $ Origin             &lt;fct&gt; non-USA, non-USA, non-USA, non-USA, non-USA...
## $ Make               &lt;fct&gt; Acura Integra, Acura Legend, Audi 90, Audi ...
```

---
最高价vs.平均价，红色三角

```r
plot(Cars93$Max.Price, Cars93$Price,col="red",pch=17)
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

---
添加最高价vs. 平均价，蓝色，圆点

```r
plot(Cars93$Max.Price, Cars93$Price,col="red",pch=17)
points(Cars93$Min.Price,Cars93$Price,col="blue",pch=16)
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---
添加一条参考线，0为截距，1为斜率，虚线

```r
plot(Cars93$Max.Price, Cars93$Price,col="red",pch=17)
points(Cars93$Min.Price,Cars93$Price,col="blue",pch=16)
abline(a = 0, b = 1, lty = 2)
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-18-1.png)&lt;!-- --&gt;

---
通过改变全局参数，使用`par()`在一个面板上画出多幅图并可修改细节：


```r
par("bg") #背景颜色，默认白色
```

```
## [1] "white"
```

```r
par("col") # 作图颜色，默认黑色
```

```
## [1] "black"
```

```r
par("mar") #(bottom, left, top, right) 图片边距
```

```
## [1] 5.1 4.1 4.1 2.1
```

```r
par("mfrow") #默认一行一列
```

```
## [1] 1 1
```

```r
?par
```

---
直方图（频率图与频数图）
truehist()频率直方图的函数，来自MASS这个包：

```r
# Set up a side-by-side plot array
par(mfrow=c(1,2))

# Create a histogram of counts with hist()
hist(Cars93$Horsepower,main="hist() plot")

# Create a normalized histogram with truehist()
truehist(Cars93$Horsepower,main="hist() plot")
```

---
直方图（频率图与频数图）
truehist()频率直方图的函数，来自MASS这个包：
![](slides_basicGraphs_files/figure-html/unnamed-chunk-21-1.png)&lt;!-- --&gt;


---
还记得前面的鸡吗？我们来做个直方图，频率的，加一条密度曲线。

```r
# Create index16, pointing to 16-week chicks
index16 &lt;- which(ChickWeight$Time == 16)

# Get the 16-week chick weights
weights &lt;- ChickWeight$weight[index16]

# Plot the normalized histogram
truehist(weights)

# Add the density curve to the histogram
lines(density(weights))
```

---
还记得前面的鸡吗？我们来做个直方图，频率的，加一条密度曲线。
![](slides_basicGraphs_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;


---
散点图中的菊花图，让你更懂数据


```r
# Set up a side-by-side plot array
par(mfrow=c(1,2))

# Create the standard scatterplot
plot(rad~zn,data=Boston)

# Add the title
title("Standard scatterplot")

# Create the sunflowerplot
sunflowerplot(rad~zn,data=Boston)

# Add the title
title("Sunflower plot")
```

---
散点图中的菊花图，让你更懂数据

![](slides_basicGraphs_files/figure-html/unnamed-chunk-25-1.png)&lt;!-- --&gt;

---

```r
#按月份，给每一个月的温度绘箱图
#month是分类变量
boxplot(Temp~Month,airquality,xlab="month", 
        ylab="Temperature (F)")
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-26-1.png)&lt;!-- --&gt;

---
with() 更简便的绘图函数，再不用每个变量都引用数据集。

```r
with(airquality, plot(Wind~Temp))
title(main="wind and temp in NYC") #使用title进行修饰
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;

---

```r
#另外一种方式添加标题，一样的结果
with(airquality, plot(Wind, Temp,
     main="wind and temp in NYC")) 
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-28-1.png)&lt;!-- --&gt;

---

```r
#有用的 type="n"
with(airquality, plot(Wind, Temp,
                      main="Wind and Temp in NYC",
                      type="n"))
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;

---

```r
with(airquality, plot(Wind, Temp,
                      main="Wind and Temp in NYC",
                      type="n"))
with(subset(airquality, Month==9), 
     points(Wind, Temp, col="red"))
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-30-1.png)&lt;!-- --&gt;


---

```r
with(airquality, plot(Wind, Temp,
                      main="Wind and Temp in NYC",
                      type="n"))
with(subset(airquality, Month==9), 
     points(Wind, Temp, col="red"))
with(subset(airquality, Month==8), 
     points(Wind, Temp, col="blue"))
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-31-1.png)&lt;!-- --&gt;

---

```r
with(airquality, plot(Wind, Temp,
                      main="Wind and Temp in NYC",
                      type="n"))
with(subset(airquality, Month==9), 
     points(Wind, Temp, col="red"))

with(subset(airquality, Month==8), 
     points(Wind, Temp, col="blue"))

with(subset(airquality, Month==7), 
     points(Wind, Temp, col="green"))
#完成了用不同的颜色表示不同的月份的点
```

---
![](slides_basicGraphs_files/figure-html/unnamed-chunk-33-1.png)&lt;!-- --&gt;

---

```r
with(airquality, plot(Wind, Temp,
                      main="Wind and Temp in NYC",
                      type="n"))
with(subset(airquality, Month==9), 
     points(Wind, Temp, col="red"))

with(subset(airquality, Month==8), 
     points(Wind, Temp, col="blue"))

with(subset(airquality, Month==7), 
     points(Wind, Temp, col="green"))

with(subset(airquality, Month %in% c(5,6)), 
     points(Wind, Temp, col="black"))
```

---
![](slides_basicGraphs_files/figure-html/unnamed-chunk-35-1.png)&lt;!-- --&gt;

---

```r
with(airquality, plot(Wind, Temp,
                      main="Wind and Temp in NYC",
                      type="n"))
with(subset(airquality, Month==9), 
     points(Wind, Temp, col="red"))

with(subset(airquality, Month==8), 
     points(Wind, Temp, col="blue"))

with(subset(airquality, Month==7), 
     points(Wind, Temp, col="green"))

with(subset(airquality, Month %in% c(5,6)), 
     points(Wind, Temp, col="black"))

fit&lt;-lm(Temp~Wind, airquality) #拟合一个回归模型
abline(fit,lwd=2) #把回归线加进去

#加入图例，说明颜色含义
legend("topright", pch=1, #右上角，空心圆点
       col=c("red","blue","green","black"),
       legend=c("Sep","August","July","Other"))
#使用基本函数绘图，需要事先计划，运行很多函数，
#可以直观的反映我们绘图的逻辑
#图例要仔细一一对应
```

---
![](slides_basicGraphs_files/figure-html/unnamed-chunk-37-1.png)&lt;!-- --&gt;

---
lattice 绘图实践

```r
library(lattice) #需要先安装install.packages("lattice")
xyplot(Temp~Ozone, data=airquality) #散点图,还没有考察交互关系
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-38-1.png)&lt;!-- --&gt;

```r
airquality$Month&lt;-factor(airquality$Month)
```

---
使用

```r
#查看不同月份下，前面两个变量的关系
xyplot(Temp~Ozone|Month, data=airquality,
       layout=c(5,1)) #画1行5列
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-39-1.png)&lt;!-- --&gt;


---
绘制表示相关性的椭圆图

越椭圆相关性越高，高到变成一条线。越接近圆相关性越低，直到标准圆。颜色越深相关性越大，最大是1,最小的是0（绝对值），蓝色为正相关，红色为负相关。



```r
# Load the corrplot library for the corrplot() function
library(corrplot)

# Extract the numerical variables from UScereal
numericalVars &lt;- UScereal[, 2:10]

# Compute the correlation matrix for these variables
corrMat &lt;- cor(numericalVars)

# Generate the correlation ellipse plot
corrplot(corrMat, method = "ellipse")
```

---

```
## corrplot 0.84 loaded
```

![](slides_basicGraphs_files/figure-html/unnamed-chunk-41-1.png)&lt;!-- --&gt;

---

完结撒花


.center[![](https://www.dropbox.com/s/9w3nxj755iqxnrz/sahua.gif?dl=1)]
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
